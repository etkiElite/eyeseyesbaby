<!DOCTYPE html>
<html lang="en">
 
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Eyes Eyes Baby</title>
 
  <!-- Bootstrap CSS -->
  <link href="http://netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css" rel="stylesheet">
 
  <style type="text/css">
  /*#stream {
    height: 99%;
    margin: 0px auto;
    display: block;
    margin-top: 20px;
  }

#stream2 {
  width: 100%;
  top: 0 px;
  left: 0px;
}

#myCanvas {
  height: 99%;
    margin: 0px auto;
    display: block;
    margin-top: 20px;
}

html, body, #img-container {
   width: 100%;
}*/

body {
        margin: 0px;
        padding: 0px;
      }

#myCanvas {
  height: 99%;
    margin: 0px auto;
    display: block;
    margin-top: 20px;
}


  </style>
 
  <!-- jQuery -->
  <script src="http://code.jquery.com/jquery.js"></script>
  <!-- Bootstrap JavaScript -->
  <script src="http://netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>
  <script src="/socket.io/socket.io.js"></script>
  <script>
var context;
  var socket = io();
  socket.on('liveStream', function(url) {
    //$('#stream').attr('src', url);
    $('#stream2').attr('src', url);

    var canvas = document.getElementById('myCanvas');
      context = canvas.getContext('2d');
      var imageObj = new Image();
      

      imageObj.onload = function() {
        context.drawImage(imageObj, 0, 0);
	
      };
      imageObj.src = url;

    $('.start').hide();
  });
 
  function startStream() {
    socket.emit('start-stream');
    $('.start').hide();
  }

function getPixelAt(x,y){
  var cont = context.getImageData(x,y,1,1).data
  return {"r" : cont[0], "g" : cont[1], "b" : cont[2]};
}

function getVal(x,y){
  var rgb = getPixelAt(x,y);
  return rgb2hsv(rgb.r, rgb.g, rgb.b).v;
}

function rgb2hsv () {
    var rr, gg, bb,
        r = arguments[0] / 255,
        g = arguments[1] / 255,
        b = arguments[2] / 255,
        h, s,
        v = Math.max(r, g, b),
        diff = v - Math.min(r, g, b),
        diffc = function(c){
            return (v - c) / 6 / diff + 1 / 2;
        };

    if (diff == 0) {
        h = s = 0;
    } else {
        s = diff / v;
        rr = diffc(r);
        gg = diffc(g);
        bb = diffc(b);

        if (r === v) {
            h = bb - gg;
        }else if (g === v) {
            h = (1 / 3) + rr - bb;
        }else if (b === v) {
            h = (2 / 3) + gg - rr;
        }
        if (h < 0) {
            h += 1;
        }else if (h > 1) {
            h -= 1;
        }
    }
    return {
        h: Math.round(h * 360),
        s: Math.round(s * 100),
        v: Math.round(v * 100)
    };
}
  </script>
</head>
<body class="container">
  <!--h1 class="text-center">My Aquarium
    <!--small>Powered by PI</small>
  <!--/h1-->
 
  <hr>
 
  <button type="button" id="" class="btn btn-info start" onclick="startStream()">Start Streaming</button>
 
  <!--div id="img-container" class="row">
    <!--img src="" id="stream"-->
    <!--canvas id="myCanvas" width="100" height="100"><img src="" id="stream2"></canvas-->
  <!--/div-->
<canvas id="myCanvas"><img src="" id="stream2"></canvas>

<!--canvas id="myCanvas"><img src="" id="stream2"></canvas-->
 
</body>
 
</html>
